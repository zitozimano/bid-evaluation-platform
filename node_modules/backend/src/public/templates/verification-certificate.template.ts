import { VerificationResultDto } from "../types/verification-result.dto";

export function renderVerificationCertificateHtml(
  data: VerificationResultDto,
): string {
  const rows = data.workflowStages
    .map(
      (s) => `
      <tr>
        <td>${s.stage}</td>
        <td>${s.label}</td>
        <td>${new Date(s.createdAt).toLocaleString()}</td>
      </tr>
    `,
    )
    .join("");

  return `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tender Outcome Verification Certificate</title>
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; font-size: 12px; color: #111827; }
    h1 { font-size: 20px; text-align: center; margin-bottom: 8px; }
    h2 { font-size: 14px; margin-top: 16px; margin-bottom: 4px; }
    .section { margin-bottom: 16px; }
    table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    th, td { border: 1px solid #e5e7eb; padding: 4px 6px; font-size: 11px; }
    th { background-color: #f3f4f6; text-align: left; }
    .meta { font-size: 11px; color: #6b7280; text-align: center; margin-top: 4px; }
  </style>
</head>
<body>
  <h1>Tender Outcome Verification Certificate</h1>
  <div class="meta">
    Tender: ${data.tenderNumber} • Hash: ${data.hash} • Verified: ${
      data.verified ? "Yes" : "No"
    }
  </div>

  <div class="section">
    <h2>Winning Bidder</h2>
    <p><strong>Name:</strong> ${data.winner.name}</p>
    <p><strong>Bidder ID:</strong> ${data.winner.bidderId}</p>
    <p><strong>Total Score:</strong> ${data.winner.totalScore}</p>
  </div>

  <div class="section">
    <h2>Workflow Timeline</h2>
    <table>
      <thead>
        <tr>
          <th>Stage</th>
          <th>Label</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        ${rows}
      </tbody>
    </table>
  </div>

  <div class="section" style="margin-top: 24px;">
    <p class="meta">Generated by Bid Evaluation Platform</p>
  </div>
</body>
</html>
`;
}
